
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{$title} - {$settings.nama_instansi}</title>
    <link rel="icon" href="{?=url()?}/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="{?=url()?}/assets/css/bootstrap.min.css">
    <link href="{?=url()?}/assets/css/font-awesome.css" rel="stylesheet">
    <script src="{?=url()?}/assets/jscripts/jquery.min.js"></script>
    <script src="{?=url()?}/assets/jscripts/bootstrap.min.js"></script>
    <style media="screen">
      body {
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        color: #fff;
      	background: #0264d6;
      	height:calc(100vh);
      	width:100%;
      }
      .antrian_judul {
        font-size:56px;
        padding-bottom:20px;
      }
      .loket {
        padding: 0;
      }
      .loket a {
        text-decoration: none;
      }
      .kiri {
        float: left;
        width:80%;
        padding: 10px;
      }
      .kanan {
        float: right;
        width:20%;
        padding: 10px;
      }
      .panel-body .no_antrian {
        font-size:90px;
        font-weight:lighter;
        padding:0;
        margin-top:-45px;
        margin-bottom:-45px;
      }
      .panel-footer .no_loket {
        font-size:40px;
        color: #000;
        padding-top:0;
        padding-bottom:0;
      }
      .panel-body .date {
        font-size:20px;
        color: #FF0000;
        font-weight:lighter;
        padding-top:5px;
        padding-bottom:5px;
        margin-top:-10px;
        margin-bottom:-10px;
      }
      .panel-footer .clock {
        font-size:36px;
        color: #000;
        padding-top:0;
        padding-bottom:0;
      }
      .panel-title.marquee {
         font-size:36px;
         padding-top: 5px;
         padding-bottom: 0px;
         margin-top: 0px;
         margin-bottom: 10px;
         color: #FF0000;
         background-color: #fff;
      }
      footer {
          position: fixed;
          right: 0px;
          bottom: 0px;
          height: 40px;
          width: calc(100% - 0px);
          font-size: 14px;
          color: #fff;
      }
      footer a, footer a:hover {
        color: #fff;
      }
    </style>
</head>
<body>
  <div class="container-fluid">
    <h1 class="text-center text-white antrian_judul"><img class="logo" src="{?=url()?}/{$logo}" alt="" width="80px"> Antrian Loket {$settings.nama_instansi}</h1>
    <div class="row loket">
      <div class="kiri">
        <div class="card bg-dark text-white">
          <div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/{$vidio}?rel=0&modestbranding=1&autohide=1&mute=0&showinfo=0&controls=1&loop=1&autoplay=1&playlist={$vidio}" allowfullscreen></iframe>
          </div>
        </div>
      </div>
      <div class="kanan">
            <div class="panel border-success">
              <div class="panel-body text-success">
                <div class="no_antrian">A<span class="antrian_Loket"><span></div>
              </div>
              <div class="panel-footer bg-transparent border-success">
                <div class="no_loket">Konter <span class="get_Loket"><span></div>
              </div>
            </div>
            <div class="panel border-success">
              <div class="panel-body text-success">
                <div class="no_antrian">B<span class="antrian_CS"><span></div>
              </div>
              <div class="panel-footer bg-transparent border-success">
                <div class="no_loket">Konter <span class="get_CS"><span></div>
                </div>
            </div>
            <div class="panel border-success">
              <div class="panel-body text-success">
                <div class="no_antrian">F<span class="antrian_Apotek"><span></div>
              </div>
              <div class="panel-footer bg-transparent border-success">
                <div class="no_loket">Konter <span class="get_Apotek"><span></div>
                </div>
            </div>
          <div class="panel border-success">
            <div class="panel-body text-success">
              <div class="date">
                <script type='text/javascript'>
                  <!--
                  var months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                  var myDays = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jum&#39;at', 'Sabtu'];
                  var date = new Date();
                  var day = date.getDate();
                  var month = date.getMonth();
                  var thisDay = date.getDay(),
                      thisDay = myDays[thisDay];
                  var yy = date.getYear();
                  var year = (yy < 1000) ? yy + 1900 : yy;
                  document.write(thisDay + ', ' + day + ' ' + months[month] + ' ' + year);
                  //-->
                </script>
              </div>
            </div>
            <div class="panel-footer border-success" style="background-color:#ffcc00;">
              <div class="clock"><span id="clock"><span></div>
            </div>
          </div>
      </div>
  </div>
  <div class="row">
    <div class="panel-title marquee">
      <marquee>{$running_text}</marquee>
    </div>
  </div>
  <footer class="visible-lg visible-md bg-primary" style="padding:10px;z-index:1000;">
    <div class="canvas">
      <p class="pull-right">
        Made with <i class="fa fa-heart text-danger"></i> by <a href="https://basoro.id/" target="_blank"><b>drg. F. Basoro</b>.</a>
        {$powered}.
      </p>
      <p><i class="fa fa-fw fa-calendar"></i> <span>{$tanggal}</span> <i class="fa fa-fw fa-clock-o"></i><span id="jam"></span> <i class="fa fa-fw fa-user"></i> <span>{?= sprintf('Login sebagai <strong>%s</strong>', $username) ?}</span></p>
    </div>
  </footer>

  <script type="text/javascript">
  function showTime() {
      var a_p = "";
      var today = new Date();
      var curr_hour = today.getHours();
      var curr_minute = today.getMinutes();
      var curr_second = today.getSeconds();
      if (curr_hour < 12) {
          a_p = "AM";
      } else {
          a_p = "PM";
      }
      if (curr_hour == 0) {
          curr_hour = 12;
      }
      if (curr_hour > 12) {
          curr_hour = curr_hour - 12;
      }
      curr_hour = checkTime(curr_hour);
      curr_minute = checkTime(curr_minute);
      curr_second = checkTime(curr_second);
      document.getElementById('clock').innerHTML = curr_hour + ":" + curr_minute + ":" + curr_second + " " + a_p;
      }

  function checkTime(i) {
      if (i < 10) {
          i = "0" + i;
      }
      return i;
  }
  setInterval(showTime, 500);
  </script>
  <script type="text/javascript">
  function showTime2() {
      var a_p = "";
      var today = new Date();
      var curr_hour = today.getHours();
      var curr_minute = today.getMinutes();
      var curr_second = today.getSeconds();
      if (curr_hour < 12) {
          a_p = "AM";
      } else {
          a_p = "PM";
      }
      if (curr_hour == 0) {
          curr_hour = 12;
      }
      if (curr_hour > 12) {
          curr_hour = curr_hour - 12;
      }
      curr_hour = checkTime2(curr_hour);
      curr_minute = checkTime2(curr_minute);
      curr_second = checkTime2(curr_second);
      document.getElementById('jam').innerHTML = curr_hour + ":" + curr_minute + ":" + curr_second + " " + a_p;
      }

  function checkTime2(i) {
      if (i < 10) {
          i = "0" + i;
      }
      return i;
  }
  setInterval(showTime2, 500);
  </script>
  <script>
  $(document).ready(function(){
    setTimeout(function(){
      getAntrian();
    }, 4000);
  });

  function getAntrian() {
    $.ajax({
        url: '{?=url()?}/anjungan/panggilantrian',
        dataType: 'json',
        success: function(data) {
            if(data.status == true && data.type !== null) {
                //console.log(data.type);
                updateLayar(data.type, data.noantrian, data.loket);
                panggil(data.panggil);
                setSelesai(data.id);
            } else {
                setTimeout(function(){
                    getAntrian();
                }, 3000);
            }
        },
        error: function(xhr) {
            console.log('An error occured.');
            console.log(xhr.status);
            setTimeout(function(){
                getAntrian();
            }, 3000);
        }
    });
  }

  function updateLayar(type, nomor, loket) {
    $('.antrian_' + type).html(nomor);
    $('.get_' + type).html(loket);
  }

  function panggil(data) {
    var ass = new Array();

    $.each(data, function(key, value){
        var filename = "{?=url()?}/plugins/anjungan/suara/" + value + ".wav";
        var auau = new Audio(filename);
        ass.push(auau);
    });

    console.log(ass);
    play_sound_queue(ass);
  }

  function play(audio, callback) {
    var akhir = true;

    audio.playbackRate = 1.0;

    const playPromise = audio.play();
    //if (playPromise !== null){
    //    playPromise.catch(() => { audio.play(); })
    //}

    if (callback) {
        //When the audio object completes it's playback, call the callback
        //provided
        audio.addEventListener('ended', callback);
        var akhir = false;
    }

    if(akhir == true) {
        audio.addEventListener('ended', function(){
            getAntrian();
        });
    }
  }

  //Changed the name to better reflect the functionality
  function play_sound_queue(sounds) {
    var index = 0;
    function recursive_play() {
        //If the index is the last of the table, play the sound
        //without running a callback after
        if (index + 1 === sounds.length) {
            play(sounds[index], null);
        } else {
            //Else, play the sound, and when the playing is complete
            //increment index by one and play the sound in the
            //indexth position of the array
            play(sounds[index], function() {
                index++;
                recursive_play();
            });
        }
    }
    //Call the recursive_play for the first time
    recursive_play();
  }

  function setSelesai(id) {
    $.ajax({
        url: '{?=url()?}/anjungan/panggilselesai',
        dataType: 'json',
        data: { id: id },
        error: function(xhr) {
            console.log(xhr.status);
        }
    });

  }
  </script>
</body>
</html>
